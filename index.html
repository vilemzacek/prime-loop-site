<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Prime Loop AI - Intelligent Automation Systems</title>
    <meta name="description" content="AI systems engineered to eliminate waste, scale profits, and give you an unfair advantage.">
    
    <link rel="icon" href="https://placehold.co/32x32/FF3B30/000000?text=P">
    <link rel="apple-touch-icon" href="https://placehold.co/180x180/FF3B30/000000?text=P">
    
    <meta property="og:image" content="https://vilemzaczek.github.io/prime-loop-site/assets/images/social-preview.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --color-primary: #FF3B30;
            --color-secondary: #FF6B4D;
            --color-background: #000000;
            --color-text-primary: #F5F5F7;
            --color-text-secondary: #A1A1AA;
            --color-accent: #27272A;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--color-background); }
        ::-webkit-scrollbar-thumb { background: var(--color-primary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-secondary); }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text-primary);
            overflow-x: hidden;
        }

        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        
        .text-glow-red {
            color: var(--color-primary);
            text-shadow: 0 0 8px rgba(255, 59, 48, 0.7), 0 0 20px rgba(255, 59, 48, 0.5);
        }

        /* Scroll Animation Base Styles */
        .scroll-animate {
            opacity: 0;
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .scroll-animate.is-visible { opacity: 1; }

        /* Specific Animations */
        .animate-jump-in { transform: translateY(60px) scale(0.95); }
        .animate-jump-in.is-visible { transform: translateY(0) scale(1); }

        .animate-slide-in-right { transform: translateX(100px); }
        .animate-slide-in-right.is-visible { transform: translateX(0); }
        
        .animate-bubble-up { transform: translateY(50px) scale(0.8); }
        .animate-bubble-up.is-visible { transform: translateY(0) scale(1); }

        .animate-fade-in { transform: translateY(20px); }
        .animate-fade-in.is-visible { transform: translateY(0); }

        /* Staggered animation delays */
        .delay-1 { transition-delay: 0.1s; }
        .delay-2 { transition-delay: 0.2s; }
        .delay-3 { transition-delay: 0.3s; }
        .delay-4 { transition-delay: 0.4s; }
        .delay-5 { transition-delay: 0.5s; }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 59, 48, 0.5), 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn-primary:hover {
            background-color: var(--color-secondary);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 0 20px rgba(255, 107, 77, 0.6), 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* Testimonials Masonry Layout */
        .testimonial-grid {
            column-count: 1;
            column-gap: 2rem;
        }
        @media (min-width: 768px) { .testimonial-grid { column-count: 2; } }
        @media (min-width: 1024px) { .testimonial-grid { column-count: 3; } }

        .testimonial-item {
            display: inline-block;
            width: 100%;
            margin-bottom: 2rem;
            break-inside: avoid;
        }
        .testimonial-card {
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
            background-color: var(--color-accent);
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid #444;
            box-shadow: 0 0 20px rgba(255, 59, 48, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .testimonial-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 30px rgba(255, 59, 48, 0.25);
        }
        .testimonial-card strong { color: var(--color-secondary); }
        
        .form-input {
            background-color: var(--color-accent);
            border: 1px solid #444;
            color: var(--color-text-primary);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-input::placeholder { color: #888; }
        .form-input:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(255, 59, 48, 0.3);
            outline: none;
        }
        
        .section-heading {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.25rem;
            line-height: 2.5rem;
            font-weight: 700;
        }
        @media (min-width: 768px) { .section-heading { font-size: 3rem; line-height: 1; } }

        /* Chatbot Hint */
        #chatbot-hint {
            position: fixed;
            bottom: 6.5rem;
            right: 2rem;
            z-index: 1098;
            background-color: var(--color-accent);
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            font-size: 0.9rem;
            border: 1px solid #444;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            opacity: 0;
            transform: translateY(10px);
            animation: hint-fade-in 0.5s 1s forwards, hint-fade-out 0.5s 5s forwards;
        }
        #chatbot-hint::after {
            content: '';
            position: absolute;
            bottom: -0.5rem;
            right: 1.5rem;
            width: 0;
            height: 0;
            border-left: 0.5rem solid transparent;
            border-right: 0.5rem solid transparent;
            border-top: 0.5rem solid var(--color-accent);
        }
        @keyframes hint-fade-in { to { opacity: 1; transform: translateY(0); } }
        @keyframes hint-fade-out { to { opacity: 0; transform: translateY(10px); } }

        #chat-widget-button { position: fixed; bottom: 2rem; right: 2rem; z-index: 1100; background-color: var(--color-primary); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 5px 20px rgba(255, 59, 48, 0.4); transition: transform 0.3s ease, background-color 0.3s ease; }
        #chat-widget-button:hover { transform: scale(1.1); background-color: var(--color-secondary); }
        #chat-container { position: fixed; bottom: 7rem; right: 2rem; width: 90vw; max-width: 400px; height: 70vh; max-height: 600px; z-index: 1099; display: flex; flex-direction: column; background: rgba(20, 20, 20, 0.6); backdrop-filter: blur(12px) saturate(120%); -webkit-backdrop-filter: blur(12px) saturate(120%); border: 1px solid var(--color-accent); border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.4); transition: opacity 0.3s ease, transform 0.3s ease; opacity: 0; transform: translateY(20px); pointer-events: none; }
        #chat-container.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
        #chat-box { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        #chat-box .message { padding: 10px 15px; border-radius: 18px; max-width: 75%; line-height: 1.5; font-family: 'Inter', sans-serif; word-wrap: break-word; }
        #chat-box .message strong { font-weight: 700; color: var(--color-text-primary); }
        #chat-box .user-message { background-color: var(--color-primary); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        #chat-box .bot-message { background: var(--color-accent); color: var(--color-text-primary); align-self: flex-start; border-bottom-left-radius: 4px; }
        #chat-box .typing-indicator { font-style: italic; opacity: 0.8; }
        #input-area { display: flex; padding: 10px; border-top: 1px solid var(--color-accent); align-items: center; }
        #chat-input { flex-grow: 1; border-radius: 20px; padding: 10px 15px; font-size: 16px; margin-right: 10px; }
        #input-area .btn-primary { flex-shrink: 0; width: 44px; height: 44px; border-radius: 50%; padding: 0; display: flex; align-items: center; justify-content: center; }
        
        /* System Activated Animation Styles */
        #system-activated-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }
        #system-activated-overlay.visible {
            opacity: 1;
            pointer-events: all;
        }
        .message-container {
            text-align: center;
            color: white;
            padding: 2rem;
        }
        .message-container p {
             min-height: 2.5rem; /* Reserve space to prevent layout shift */
        }
        .message-container #msg1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            color: var(--color-primary);
            text-shadow: 0 0 15px var(--color-primary);
        }
        .message-container #msg2 {
            font-size: 1.25rem;
            color: var(--color-text-secondary);
        }
         .message-container #msg3 {
            font-size: 1.125rem; /* Bigger */
            color: var(--color-text-primary); /* White */
            font-weight: 700; /* Bold */
        }

    </style>
</head>
<body class="relative">

    <header class="fixed top-0 left-0 w-full p-4 md:p-6 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#hero" class="font-orbitron text-white hover:text-gray-300 transition-colors duration-300 font-bold text-2xl">Prime Loop</a>
            <a href="#contact" class="btn-primary py-2 px-6 rounded-full text-base">Get Started</a>
        </div>
    </header>

    <main>
        <section id="hero" class="min-h-screen flex flex-col justify-center items-center text-center px-4 relative">
            <div class="scroll-animate animate-jump-in">
                <h1 class="font-orbitron text-4xl md:text-6xl font-black uppercase tracking-tight leading-tight">
                    You donâ€™t rise to the level of your <span class="text-glow-red">goals</span>.
                    <br>
                    You fall to the level of your <span class="text-glow-red">systems</span>.
                </h1>
                <div class="max-w-2xl mx-auto mt-8 mb-10 space-y-4">
                    <p class="text-xl md:text-2xl text-gray-200"><strong class="text-white">We build those systems.</strong></p>
                    <p class="text-lg text-gray-400">AI systems engineered to eliminate waste, scale profits, and give you an unfair advantage.</p>
                </div>
                <a href="#contact" class="btn-primary py-4 px-10 rounded-lg text-lg">Claim My Free AI Audit</a>
            </div>
        </section>
        
        <section id="services" class="py-24 sm:py-32">
            <div class="container mx-auto px-4 text-center">
                <div class="scroll-animate animate-slide-in-right">
                    <h2 class="section-heading">Solutions Designed to <span class="text-glow-red">Streamline and Scale</span></h2>
                    <p class="mt-4 text-lg text-gray-400">We build custom-fit automation assets that become a core part of your operations.</p>
                </div>
                <div class="grid md:grid-cols-3 gap-8 mt-16 max-w-6xl mx-auto">
                    <div class="scroll-animate animate-bubble-up delay-1"><div class="service-item bg-zinc-900/50 p-8 rounded-2xl border border-zinc-800 text-left h-full"><span class="font-orbitron text-red-500">01</span><h3 class="font-orbitron text-2xl font-semibold my-3">Workflow Automation</h3><p class="text-gray-400">We engineer tailored automation strategies to streamline operations, enhance productivity, and eliminate manual tasks, ensuring perfect alignment with your business processes.</p></div></div>
                    <div class="scroll-animate animate-bubble-up delay-2"><div class="service-item bg-zinc-900/50 p-8 rounded-2xl border border-zinc-800 text-left h-full"><span class="font-orbitron text-red-500">02</span><h3 class="font-orbitron text-2xl font-semibold my-3">AI Agents</h3><p class="text-gray-400">Leverage our transformative AI Agent solutions to automate complex tasks, elevate decision-making, and gain operational intelligence with custom-configured systems that adapt to your workflows.</p></div></div>
                    <div class="scroll-animate animate-bubble-up delay-3"><div class="service-item bg-zinc-900/50 p-8 rounded-2xl border border-zinc-800 text-left h-full"><span class="font-orbitron text-red-500">03</span><h3 class="font-orbitron text-2xl font-semibold my-3">Custom Apps & Dashboards</h3><p class="text-gray-400">Gain critical visibility in a data-driven world. We build real-time, custom dashboards and applications to track performance, visualize key metrics, and make smarter, data-backed decisions.</p></div></div>
                </div>
            </div>
        </section>

        <section id="process" class="py-24 sm:py-32">
            <div class="container mx-auto px-4 text-center">
                <div class="scroll-animate animate-fade-in">
                    <h2 class="section-heading">Transform Your Business in <span class="text-glow-red">3 Simple Steps</span></h2>
                </div>
                <div class="grid md:grid-cols-3 gap-8 mt-16 max-w-6xl mx-auto text-left">
                    <div class="scroll-animate animate-fade-in delay-1"><div class="p-8"><h3 class="font-orbitron text-5xl font-bold text-zinc-800">01</h3><h4 class="font-orbitron text-2xl font-semibold my-3">Discover</h4><p class="text-gray-400">Schedule a consultation to discuss your needs and goals. We'll tailor our services to meet your specific requirements.</p></div></div>
                    <div class="scroll-animate animate-fade-in delay-2"><div class="p-8"><h3 class="font-orbitron text-5xl font-bold text-zinc-800">02</h3><h4 class="font-orbitron text-2xl font-semibold my-3">Build</h4><p class="text-gray-400">Our team of experts will get to work on your project right away, providing regular updates and ensuring everything is on track.</p></div></div>
                    <div class="scroll-animate animate-fade-in delay-3"><div class="p-8"><h3 class="font-orbitron text-5xl font-bold text-zinc-800">03</h3><h4 class="font-orbitron text-2xl font-semibold my-3">Scale</h4><p class="text-gray-400">Experience the benefits of our work with tangible results that meet and exceed your expectations. Your success is our priority.</p></div></div>
                </div>
            </div>
        </section>
        
        <section id="testimonials" class="py-24 sm:py-32">
            <div class="container mx-auto px-4 text-center">
                <div class="scroll-animate animate-fade-in">
                    <h2 class="section-heading">What Our <span class="text-glow-red">Clients</span> Say</h2>
                </div>
            </div>
            <div class="testimonial-grid container mx-auto px-4 mt-16">
                <div class="testimonial-item scroll-animate animate-fade-in delay-1"><div class="testimonial-card"><p>"I had no clue how much time we were <strong>wasting</strong> until Prime Loop built out our automations. What used to take us <strong>3â€“4 hours a day</strong> now runs silently in the background. I actually sleep better knowing weâ€™re not bleeding time anymore."</p><cite class="mt-4 block text-sm not-italic text-gray-500">- Operations Manager</cite></div></div>
                <div class="testimonial-item scroll-animate animate-fade-in delay-2"><div class="testimonial-card"><p>"I didn't think automation could be this simple. We literally <strong>stopped hiring for admin</strong>."</p><cite class="mt-4 block text-sm not-italic text-gray-500">- SaaS Founder</cite></div></div>
                <div class="testimonial-item scroll-animate animate-fade-in delay-3"><div class="testimonial-card"><p>"We cut our lead response time from 48 hours to <strong>under 10 minutes</strong> without hiring anyone. The ROI on this automation paid itself back in <strong>2 weeks</strong>."</p><cite class="mt-4 block text-sm not-italic text-gray-500">- Sales Director</cite></div></div>
                <div class="testimonial-item scroll-animate animate-fade-in delay-4"><div class="testimonial-card"><p>"Before Prime Loop, we were losing deals because we didnâ€™t follow up in time. Now every lead gets a personalized reply, quote, and calendar link within minutes and <strong>conversions shot up</strong>."</p><cite class="mt-4 block text-sm not-italic text-gray-500">- Agency Owner</cite></div></div>
                <div class="testimonial-item scroll-animate animate-fade-in delay-5"><div class="testimonial-card"><p>"Saved us <strong>hours</strong>. Every week."</p><cite class="mt-4 block text-sm not-italic text-gray-500">- Project Manager</cite></div></div>
                <div class="testimonial-item scroll-animate animate-fade-in delay-1"><div class="testimonial-card"><p>"Our internal quote process was chaos. Prime Loop turned it into a <strong>smooth 3-step flow</strong> that anyone on the team can use, no training needed."</p><cite class="mt-4 block text-sm not-italic text-gray-500">- Head of Operations</cite></div></div>
                <div class="testimonial-item scroll-animate animate-fade-in delay-2"><div class="testimonial-card"><p>"I literally clicked once, and the whole report was built and emailed to the client. Weâ€™ve <strong>never looked more professional</strong>."</p><cite class="mt-4 block text-sm not-italic text-gray-500">- Consultant</cite></div></div>
                <div class="testimonial-item scroll-animate animate-fade-in delay-3"><div class="testimonial-card"><p>"We used to write out every quote manually. Now itâ€™s <strong>fully automated</strong> and even looks better than what we had before."</p><cite class="mt-4 block text-sm not-italic text-gray-500">- Small Business Owner</cite></div></div>
                 <div class="testimonial-item scroll-animate animate-fade-in delay-4"><div class="testimonial-card"><p>"We stopped <strong>chasing leads</strong> and started <strong>closing them</strong>. Prime Loop removed all the manual steps and gave us a system that <strong>runs itself</strong>. Itâ€™s like adding a full-time employee without hiring anyone and paying them $50,000 a year."</p><cite class="mt-4 block text-sm not-italic text-gray-500">- Growth Lead</cite></div></div>
            </div>
        </section>

        <section id="contact" class="py-24 sm:py-32">
            <div class="container mx-auto px-4">
                <div class="max-w-2xl mx-auto text-center">
                    <div class="scroll-animate animate-fade-in">
                        <h2 class="section-heading">Talk To An <span class="text-glow-red">Expert</span></h2>
                        <p class="mt-4 text-lg text-gray-400">See exactly how much time and money you can save. No-pressure, just a clear, actionable plan.</p>
                    </div>
                    <form id="contactForm" action="https://formspree.io/f/mzzggrjo" method="POST" class="space-y-6 text-left mt-12">
                        <div class="scroll-animate animate-fade-in delay-1">
                            <label for="name" class="block text-sm font-medium text-gray-400">Full Name</label>
                            <input type="text" name="name" id="name" required class="form-input mt-1 block w-full rounded-md p-3 text-base">
                        </div>
                        <div class="scroll-animate animate-fade-in delay-2">
                            <label for="email" class="block text-sm font-medium text-gray-400">Email Address</label>
                            <input type="email" name="email" id="email" required class="form-input mt-1 block w-full rounded-md p-3 text-base">
                        </div>
                        <div class="scroll-animate animate-fade-in delay-3">
                            <label for="message" class="block text-sm font-medium text-gray-400">Your Biggest Challenge</label>
                            <textarea name="message" id="message" rows="4" required class="form-input mt-1 block w-full rounded-md p-3 text-base" placeholder="Weâ€™re stuck doing everything manually quoting, follow ups, updates and its killing our time"></textarea>
                        </div>
                        <div class="scroll-animate animate-fade-in delay-4">
                            <button type="submit" class="w-full btn-primary py-3 px-6 rounded-lg text-lg">Claim My AI Strategy Session</button>
                        </div>
                    </form>
                    <div id="formResponseMessage" class="text-center mt-4 h-6"></div>
                </div>
            </div>
        </section>
    </main>

    <footer class="py-8 text-center border-t border-zinc-900">
        <div class="container mx-auto px-4"><p class="text-gray-500">&copy; <span id="currentYear"></span> Prime Loop AI. All rights reserved.</p></div>
    </footer>
    
    <div id="chatbot-hint">Your AI assistant is here to help! ðŸ‘‰</div>
    <div id="chat-widget-button"><svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div>
    <div id="chat-container">
        <div id="chat-box"><div class="message bot-message">Hello! I'm Loop. Do you have any questions regarding our service before you connect with our human team?</div></div>
        <div id="input-area"><input type="text" id="chat-input" class="form-input" placeholder="Ask about our AI solutions..."><button id="send-button" class="btn-primary"><svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M3.105 2.289a.75.75 0 00-.826.95l1.414 4.949a.75.75 0 00.95.826L11.25 9.25v1.5L4.643 11.99a.75.75 0 00-.95.826l-1.414 4.949a.75.75 0 00.95.826L16.25 12l-13.145-9.711z" /></svg></button></div>
    </div>
    
    <!-- System Activated Animation Overlay -->
    <div id="system-activated-overlay">
        <div class="message-container">
            <p id="msg1"></p>
            <p id="msg2" class="mt-4"></p>
            <p id="msg3" class="mt-6"></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                    } else {
                        entry.target.classList.remove('is-visible');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.scroll-animate').forEach(el => {
                observer.observe(el);
            });

            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
                });
            });

            document.getElementById('currentYear').textContent = new Date().getFullYear();

            const contactForm = document.getElementById('contactForm');
            const systemOverlay = document.getElementById('system-activated-overlay');
            const msg1 = document.getElementById('msg1');
            const msg2 = document.getElementById('msg2');
            const msg3 = document.getElementById('msg3');

            function typeMessage(element, text, speed = 50) {
                return new Promise(resolve => {
                    let i = 0;
                    element.innerHTML = "";
                    const timer = setInterval(() => {
                        if (i < text.length) {
                            element.innerHTML += text.charAt(i);
                            i++;
                        } else {
                            clearInterval(timer);
                            resolve();
                        }
                    }, speed);
                });
            }

            async function triggerSystemAnimation() {
                systemOverlay.classList.add('visible');
                
                msg1.innerHTML = '';
                msg2.innerHTML = '';
                msg3.innerHTML = '';
                
                await typeMessage(msg1, "System Activated.");
                await typeMessage(msg2, "Youâ€™ve just stepped into the future of how business gets done.");
                await typeMessage(msg3, "My team will get back to you within 24h.");

                setTimeout(() => {
                    systemOverlay.classList.remove('visible');
                }, 4000); // Increased duration to allow reading
            };
            
            if (contactForm) {
                contactForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // --- ACTUAL FORM SUBMISSION LOGIC ---
                    const form = e.target;
                    const data = new FormData(form);
                    const formResponseMessage = document.getElementById('formResponseMessage');
                    
                    fetch(form.action, { method: 'POST', body: data, headers: { 'Accept': 'application/json' }})
                    .then(response => {
                        if (response.ok) {
                            triggerSystemAnimation();
                            form.reset();
                        } else {
                            response.json().then(data => {
                                formResponseMessage.textContent = data.errors ? data.errors.map(err => err.message).join(', ') : "Oops! There was a problem.";
                                formResponseMessage.style.color = 'var(--color-secondary)';
                            });
                        }
                    }).catch(() => {
                        formResponseMessage.textContent = "Oops! Network error. Please try again.";
                        formResponseMessage.style.color = 'var(--color-secondary)';
                    });
                    setTimeout(() => { formResponseMessage.textContent = ''; }, 7000);
                });
            }
            
            const chatWidgetButton = document.getElementById('chat-widget-button');
            const chatContainer = document.getElementById('chat-container');
            const chatBox = document.getElementById('chat-box');
            const chatInput = document.getElementById('chat-input');
            const chatSendButton = document.getElementById('send-button');
            const MAKE_WEBHOOK_URL = 'https://hook.eu2.make.com/xdmt3eewueg9ojy56qi9wbn95xjtusxx';
            let threadId = null;

            chatWidgetButton.addEventListener('click', () => chatContainer.classList.toggle('visible'));
            chatSendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });

            async function sendMessage() {
                const messageText = chatInput.value.trim();
                if (messageText === '') return;
                displayMessage(messageText, 'user');
                chatInput.value = '';
                showTypingIndicator(true);
                try {
                    const response = await fetch(MAKE_WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: messageText, threadId: threadId })
                    });
                    if (!response.ok) throw new Error(`Webhook call failed`);
                    const data = await response.json();
                    if(data.threadId) threadId = data.threadId;
                    showTypingIndicator(false);
                    if(data.reply) {
                        displayMessage(data.reply, 'bot');
                    } else {
                        displayMessage("Sorry, I didn't get a valid response.", 'bot');
                    }
                } catch (error) {
                    showTypingIndicator(false);
                    displayMessage('Sorry, a critical error occurred.', 'bot');
                }
            }

            function displayMessage(text, sender) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', `${sender}-message`);

                if (sender === 'bot') {
                    let formattedText = text
                        .replace(/&/g, "&amp;")
                        .replace(/</g, "&lt;")
                        .replace(/>/g, "&gt;");
                    formattedText = formattedText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    formattedText = formattedText.replace(/\\n\s*(\*|\-)\s/g, '<br>â€¢ ');
                    formattedText = formattedText.replace(/\\n/g, '<br>');
                    
                    chatBox.appendChild(messageElement);
                    typewriterEffect(messageElement, formattedText, 20);
                } else {
                    messageElement.textContent = text;
                    chatBox.appendChild(messageElement);
                    chatBox.scrollTop = chatBox.scrollHeight;
                }
            }

            function typewriterEffect(element, text, speed) {
                let i = 0;
                element.innerHTML = "";
                const timer = setInterval(() => {
                    // Check if user is near the bottom BEFORE adding new content
                    const isUserAtBottom = chatBox.scrollHeight - chatBox.scrollTop <= chatBox.clientHeight + 20;

                    if (i < text.length) {
                        if (text.charAt(i) === '<') {
                            const endIndex = text.indexOf('>', i);
                            if (endIndex !== -1) {
                                element.innerHTML += text.substring(i, endIndex + 1);
                                i = endIndex;
                            } else {
                                element.innerHTML += text.charAt(i);
                            }
                        } else {
                             element.innerHTML += text.charAt(i);
                        }
                        i++;
                        
                        // Only scroll if they were at the bottom before this character was added
                        if (isUserAtBottom) {
                            chatBox.scrollTop = chatBox.scrollHeight;
                        }
                    } else {
                        clearInterval(timer);
                    }
                }, speed);
            }

            function showTypingIndicator(show) {
                let indicator = document.querySelector('.typing-indicator');
                if (show && !indicator) {
                    indicator = document.createElement('div');
                    indicator.className = 'message bot-message typing-indicator';
                    indicator.textContent = 'Loop is typing...';
                    chatBox.appendChild(indicator);
                    chatBox.scrollTop = chatBox.scrollHeight;
                } else if (!show && indicator) {
                    indicator.remove();
                }
            }
        });
    </script>
</body>
</html>
